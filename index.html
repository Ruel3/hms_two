<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>HMS – OOP single file + login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    :root{--p:#00796b;--l:#e0f2f1}
    body{margin:0;font:16px/1.4 system-ui;background:var(--l)}
    header{background:var(--p);color:#fff;padding:.5rem 1rem}
    nav a{color:#fff;margin-right:1rem;text-decoration:none}
    main{padding:1rem;max-width:800px;margin:auto}
    section{border:1px solid #ccc;background:#fff;padding:1rem;margin-bottom:1rem;border-radius:4px}
    form{display:grid;gap:.5rem}
    input,select,button{padding:.4rem}
    button{background:var(--p);color:#fff;border:0;cursor:pointer}
    table{width:100%;border-collapse:collapse;font-size:.9rem}
    th,td{padding:.3rem .5rem;border:1px solid #ddd}
    th{background:var(--l)}
    .hidden{display:none}
  </style>
</head>
<body>

<!-- ============ LOGIN SECTION ============ -->
<section id="loginSect">
  <h2>Hospital System Login</h2>
  <form id="loginForm">
    <input id="userIn" placeholder="User ID" required>
    <input id="pwdIn"  placeholder="Password" type="password" required>
    <button>Login</button>
  </form>
  <p id="loginMsg"></p>
</section>

<!-- ============ APPLICATION HEADER (shown after login) ============ -->
<header id="appHeader" class="hidden">
  <h1>Hospital Management System</h1>
  <nav>
    <button onclick="showPage('reception')"  class="role RECEPTION">Reception</button>
    <button onclick="showPage('nurse')"      class="role NURSE">Nurse</button>
    <button onclick="showPage('doctor')"     class="role DOCTOR">Doctor</button>
    <button onclick="showPage('billing')"    class="role BILLING">Billing</button>
    <button onclick="doLogout()">Logout</button>
  </nav>
</header>

<main id="appMain" class="hidden">

  <!-- RECEPTION -->
  <section id="reception" class="page">
    <h2>Register Patient</h2>
    <form id="regForm">
      <input name="fullName" placeholder="Full Name" required>
      <input name="age" type="number" min="0" max="150" placeholder="Age" required>
      <select name="gender" required>
        <option value="">Gender</option><option>MALE</option><option>FEMALE</option><option>OTHER</option>
      </select>
      <input name="phone" placeholder="Phone" required>
      <input name="email" type="email" placeholder="Email">
      <input name="address" placeholder="Address">
      <button>Register</button>
    </form>
    <p id="regOut"></p>

    <h3>Schedule Appointment</h3>
    <form id="aptForm">
      <input name="patientId" placeholder="Patient ID" required>
      <input name="doctorId" placeholder="Doctor Staff-ID" required>
      <input name="when" type="datetime-local" required>
      <button>Schedule</button>
    </form>
    <p id="aptOut"></p>
  </section>

  <!-- NURSE -->
  <section id="nurse" class="page hidden">
    <h2>Nurse Triage</h2>
    <form id="triageForm">
      <input name="patientId" placeholder="Patient ID" required>
      <input name="bp" placeholder="Blood Pressure (120/80)" required>
      <input name="temp" type="number" step=".1" placeholder="Temperature °C" required>
      <input name="pulse" type="number" placeholder="Pulse /min" required>
      <textarea name="symptoms" placeholder="Chief complaints" required></textarea>
      <button>Save Triage</button>
    </form>
    <p id="triageOut"></p>
  </section>

  <!-- DOCTOR -->
  <section id="doctor" class="page hidden">
    <h2>Doctor Diagnosis</h2>
    <form id="dxForm">
      <input name="patientId" placeholder="Patient ID" required>
      <textarea name="notes" placeholder="Diagnosis notes" required></textarea>
      <button>Save Diagnosis</button>
    </form>
    <p id="dxOut"></p>

    <h3>Prescribe Medication</h3>
    <form id="rxForm">
      <input name="patientId" placeholder="Patient ID" required>
      <input name="medId" placeholder="Medication ID" required>
      <input name="qty" type="number" min="1" placeholder="Quantity" required>
      <input name="dosage" placeholder="Dosage (e.g. 1+0+1)" required>
      <button>Prescribe</button>
    </form>
    <p id="rxOut"></p>
  </section>

  <!-- BILLING -->
  <section id="billing" class="page hidden">
    <h2>Patient Billing</h2>
    <input id="billSearch" placeholder="Patient ID">
    <button onclick="searchBill()">Search</button>
    <table id="billTable"></table>
  </section>

</main>

<script>
/* ********************************************************************
 *  BACK-END SIMULATION – PURE JS BUT STRUCTURED IN AN OOP WAY
 *  (shows exactly where encapsulation, inheritance & polymorphism occur)
 ******************************************************************** */

// ---------- Encapsulation: private props via closures ----------
class Staff {                       // ****** PARENT CLASS ******
  #id; #name; #dept; #phone; #email;
  constructor(id,name,dept,phone,email){
    this.#id=id; this.#name=name; this.#dept=dept; this.#phone=phone; this.#email=email;
  }
  getId(){return this.#id;}
  getName(){return this.#name;}
  getDept(){return this.#dept;}
  // polymorphic method – overridden by sub-classes
  getRole(){ return "Staff"; }
}

// ---------- Inheritance: Doctor is-a Staff ----------
class Doctor extends Staff {
  #spec; #license;
  constructor(id,name,dept,phone,email,spec,license){
    super(id,name,dept,phone,email);   // reuse parent ctor
    this.#spec=spec; this.#license=license;
  }
  getRole(){return "DOCTOR";}
  getSpec(){return this.#spec;}
  getLicense(){return this.#license;}
}

// ---------- Inheritance: Nurse is-a Staff ----------
class Nurse extends Staff {
  #shift; #cert;
  constructor(id,name,dept,phone,email,shift,cert){
    super(id,name,dept,phone,email);
    this.#shift=shift; this.#cert=cert;
  }
  getRole(){return "NURSE";}
}

// ---------- Encapsulation: singleton façade ----------
class HospitalDB {
  constructor(){
    this.patients   = [];   // array of plain objects
    this.staff      = [];   // array of Staff instances (Doctor/Nurse)
    this.apps       = [];
    this.meds       = [];
    this.bills      = [];
    this.nextPatId  = 1;
    this.nextStaffId= 1;
    this.nextBillId = 1;
    this.seed();
  }
  seed(){
    // insert some meds
    this.meds.push({medId:"M-PARA", name:"Paracetamol 500mg", stock:200, price:0.10});
    this.meds.push({medId:"M-AMOX", name:"Amoxicillin 250mg", stock:150, price:0.25});
    // insert doctors (polymorphic usage: Staff ref points to Doctor)
    this.staff.push(new Doctor("D-001","Dr Brown","Cardiology","555111","brown@hms.com","Cardiology","MD-10234"));
    this.staff.push(new Doctor("D-002","Dr Lee","Paediatrics","555222","lee@hms.com","Paediatrics","MD-20456"));
    // insert nurses
    this.staff.push(new Nurse("N-001","Nurse Joy","Emergency","555333","joy@hms.com","Day","RN-1"));
  }
  // ---------- CRUD helpers ----------
  generatePatientId(){ return "P-"+String(this.nextPatId++).padStart(6,'0'); }
  generateBillingId(){ return "B-"+String(this.nextBillId++).padStart(6,'0'); }
  findStaffById(id){ return this.staff.find(s=>s.getId()===id); }
  findMedById(id)  { return this.meds.find(m=>m.medId===id); }
  findPatientById(id){ return this.patients.find(p=>p.patientId===id); }
}
const DB = new HospitalDB();   // single instance

/* ********************************************************************
 *  LOGIN LOGIC
 ******************************************************************** */
const CREDENTIALS = {           // hard-coded for demo
  "reception1":{pwd:"rec123", role:"RECEPTION"},
  "nurse1"    :{pwd:"nur123", role:"NURSE"},
  "doctor1"   :{pwd:"doc123", role:"DOCTOR"},
  "billing1"  :{pwd:"bil123", role:"BILLING"}
};
let CURRENT_USER = null;

document.getElementById('loginForm').onsubmit = e =>{
  e.preventDefault();
  const uid = document.getElementById('userIn').value.trim();
  const pwd = document.getElementById('pwdIn').value.trim();
  const rec = CREDENTIALS[uid];
  if(rec && rec.pwd===pwd){
    CURRENT_USER = {uid, role:rec.role};
    document.getElementById('loginSect').classList.add('hidden');
    document.getElementById('appHeader').classList.remove('hidden');
    document.getElementById('appMain').classList.remove('hidden');
    // show only role-relevant menus
    document.querySelectorAll('.role').forEach(btn=>{
      btn.style.display = btn.classList.contains(CURRENT_USER.role) ? 'inline-block':'none';
    });
    showPage('reception');
  } else {
    document.getElementById('loginMsg').textContent = 'Invalid credentials';
  }
};
function doLogout(){
  CURRENT_USER=null;
  location.reload();
}

/* ********************************************************************
 *  NAVIGATION
 ******************************************************************** */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* ********************************************************************
 *  RECEPTION USE-CASES
 ******************************************************************** */
document.getElementById('regForm').onsubmit = e =>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const o = Object.fromEntries(fd.entries());
  o.age = +o.age;
  const pid = DB.generatePatientId();
  o.patientId = pid;
  DB.patients.push(o);
  document.getElementById('regOut').textContent = `Registered. Patient-ID = ${pid}`;
  e.target.reset();
};

document.getElementById('aptForm').onsubmit = e =>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const patId = fd.get('patientId');
  const docId = fd.get('doctorId');
  if(!DB.findPatientById(patId))  { alert('Patient not found'); return; }
  if(!DB.findStaffById(docId))    { alert('Doctor not found'); return; }
  DB.apps.push({patientId:patId, doctorId:docId, dateTime:fd.get('when'), status:'SCHEDULED'});
  document.getElementById('aptOut').textContent = 'Appointment scheduled';
  e.target.reset();
};

/* ********************************************************************
 *  NURSE TRIAGE
 ******************************************************************** */
document.getElementById('triageForm').onsubmit = e =>{
  e.preventDefault();
  const o = Object.fromEntries(new FormData(e.target).entries());
  if(!DB.findPatientById(o.patientId)){ alert('Patient not found'); return; }
  // in real world we would store vitals – here we just acknowledge
  document.getElementById('triageOut').textContent = 'Triage saved';
  e.target.reset();
};

/* ********************************************************************
 *  DOCTOR DIAGNOSIS / PRESCRIPTION
 ******************************************************************** */
document.getElementById('dxForm').onsubmit = e =>{
  e.preventDefault();
  const o = Object.fromEntries(new FormData(e.target).entries());
  if(!DB.findPatientById(o.patientId)){ alert('Patient not found'); return; }
  document.getElementById('dxOut').textContent = 'Diagnosis saved';
  e.target.reset();
};

document.getElementById('rxForm').onsubmit = e =>{
  e.preventDefault();
  const o = Object.fromEntries(new FormData(e.target).entries());
  o.qty = +o.qty;
  if(!DB.findPatientById(o.patientId)){ alert('Patient not found'); return; }
  const med = DB.findMedById(o.medId);
  if(!med){ alert('Medication not found'); return; }
  if(med.stock < o.qty){ alert('Insufficient stock'); return; }
  med.stock -= o.qty;
  DB.bills.push({patientId:o.patientId, service:'Medication '+med.name, charge:med.price*o.qty});
  document.getElementById('rxOut').textContent = 'Prescribed & stock updated';
  e.target.reset();
};

/* ********************************************************************
 *  BILLING SEARCH
 ******************************************************************** */
function searchBill(){
  const pid = document.getElementById('billSearch').value.trim();
  const rows = DB.bills.filter(b=>b.patientId===pid);
  const tbl = document.getElementById('billTable');
  if(!rows.length){ tbl.innerHTML='<tr><td>No bill</td></tr>'; return; }
  let tot = 0;
  let html='';
  rows.forEach(r=>{ html+=`<tr><td>${r.service}</td><td>${r.charge.toFixed(2)}</td></tr>`; tot+=r.charge; });
  html+=`<tr><th>Total</th><th>${tot.toFixed(2)}</th></tr>`;
  tbl.innerHTML = html;
}
</script>
</body>
</html>
